<% content_for(:static_navbar, true) %>
<% content_for(:page_title, @map.name + " - Edit") %>

<%= centered_content do %>

<div class="map-header">
  <h1 class="map-title"><%= @map.name %></h1>  
</div>

<div class="row map-top-row">
  <div class="col col-xs-6 map-author">
    <%= render partial: 'byline', locals: { map: @map } %>
    &nbsp;<%= link_to 'edit meta', edit_meta_map_path(@map) %>
    &nbsp;<%= link_to 'view', map_path(@map), data: { confirm: "Are you sure? Unsaved changes will be lost!" } %>
  </div>
</div>

<div id="netmap" class="netmap-editing">
  <%= render partial: 'controls' %>
  <%= render partial: 'custom_controls' %>
</div>

<%= render partial: 'edit_controls', locals: { map: @map } %>

<% if @map.description.present? %>
  <div id="map-description">
    <br />
    <%= raw(@map.description) %>
  </div>
<% end %>


<div id="netmap-edit-guide">

<h3>Editing Guide</h3>
<br>

<strong>Sidebar</strong><br>
<br>
Type a name in the "add entity" box to search for a LittleSis entity; click a result to add it to the map; all relationships between it and entities already on the map will be added too<br>
<br>
"wheel" button arranges nodes in a circle<br>
"force" button arranges nodes using physics<br>
"recenter" moves nodes so that they are centered around the map's zero coordinates; this will not change the layout of nodes relative to to each other<br>
<br>
Click on any number of "Categories" to limit edges to those categories<br>
<br>
Select "Current" to hide non-current edges<br>
<br>
Changes to map will not be saved until you click "save"<br>
<br>

<strong>Shortcut Keys</strong><br>
<br>
CLICK a node or edge to select or deselect it<br>
<br>
CTRL+D deletes a selected node or edge<br>
CTRL+N adds a custom node<br>
CTRL+E adds a custom edge<br>
CTRL+T adds a custom text block<br>
<br>
CTRL+R adds entities related to a selected entity<br>
<br>
CTRL+"=" zooms in<br>
CTRL+"-" zooms out<br>
CTRL+0 resets zoom<br>
<br>
If CTRL keys interfere with your browser or operating system shortcuts, all of the above shortcuts will work with ALT instead of CTRL<br>
<br>

<strong>Editing Nodes and Edges</strong><br>
<br>
Select a node or edge to view an editing form in the top-right corner of the map; click "Apply" to apply changes to the map<br>
<br>

<strong>Zooming</strong><br>
<br>
Use mouse scrolling, the buttons in the upper-left corner of the map, or shortcut keys to zoom in or out<br>
<br>
Current zoom level will be preserved when saving a map

</div>


<% end %>

<script>
var data = <%= raw @map.prepared_data %>;
var width = $('#netmap').width();
var height = <%= Lilsis::Application.config.netmap_default_height %>;
var key = '<%= Lilsis::Application.config.netmap_api_key %>';
var netmap = new Netmap(width, height, "#netmap", key, false);
netmap.set_network_map_id(<%= @map.id %>);
netmap.set_user_id(<%= @map.user_id %>);
netmap.set_data(data);
netmap.auto_center();
<% if @map.zoom.present? %>
netmap.zoom_by(<%= @map.zoom %>);
<% end %>
netmap.build();
</script>